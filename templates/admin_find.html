{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Admin's Dashboard - Find</h1>

    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('admin_dashboard') }}">Info</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="#find">Find</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('admin_stats') }}">Stats</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
        </li>
    </ul>

    <form action="{{ url_for('admin_find') }}" method="get" class="mb-4">
        
        <div class="input-group">
            <input type="text" name="search" class="form-control" placeholder="Search..." value="{{ search_query }}">
            
            <select name="filter" class="form-select">
                <option value="all" {% if filter_type=='all' %}selected{% endif %}>All</option>
                <option value="sponsors" {% if filter_type=='sponsors' %}selected{% endif %}>Sponsors</option>
                <option value="campaigns" {% if filter_type=='campaigns' %}selected{% endif %}>Campaigns</option>
                <option value="influencers" {% if filter_type=='influencers' %}selected{% endif %}>Influencers</option>
            </select>

            <button type="submit" class="btn btn-primary">Search</button>
        </div>

    </form>



    {% for result in results %}
   
    <div class="card mb-2">
        <div class="card-body">
            
            <div class="d-flex justify-content-between align-items-center">
                
                <div>
                    {% if result.__class__.__name__ == 'Sponsor' %}
                    Sponsor: {{ result.name }} | Industry: {{ result.industry }}
                    {% elif result.__class__.__name__ == 'Campaign' %}
                    Campaign: {{ result.name }} | Sponsor: {{ result.sponsor.name }}
                    {% elif result.__class__.__name__ == 'Influencer' %}
                    Influencer: {{ result.name }} | Category: {{ result.category }}
                    {% endif %}
                </div>

                <div>
                    <a href="{{ url_for('view_' + result.__class__.__name__.lower(), id=result.id) }}"
                        class="btn btn-primary btn-sm">View</a>
                    {% set user = result.user if result.__class__.__name__ != 'Campaign' else result.sponsor.user %}
                    {% if not user.is_flagged %}
                    
                    <a href="{{ url_for('flag_item', type=result.__class__.__name__.lower(), id=result.id) }}"
                        class="btn btn-warning btn-sm">Flag</a>
                    {% else %}
                    <span class="badge bg-danger">Flagged</span>
                    {% endif %}
                </div>

            </div>

        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}